<!DOCTYPE html>
<html>
<head>
  <% include ../partials/header.ejs %>
 
<script>
  function normalizeName(name){
    if(name.includes("New York")){
      return (name.replace("New York ", "NY-"));
    }
    else if (name.includes("Los Angeles")){
      return (name.replace("Los Angeles ", "LA-"));
    }
    else
      return (name.substr(0,(name.lastIndexOf(" ")))).replace(" ", "-");
  }
  function findWinner(home, away){
    var button = document.getElementById(home).innerHTML = "Calculating...";
    var id = home;
    var team1 = normalizeName(home);
    var team2 = normalizeName(away);

    var urlString = `/findWinner?home=${team1}&away=${team2}`;
    $.ajax({url:urlString, success: (res)=>{
      var td = document.getElementById(id).parentElement;
      td.innerHTML = "<b>" + res + "</b>";
    }
    });
  }
  function loadWeek(){
    var week = document.getElementById("weekSelect").value;
    var table = document.getElementById("schedule");
    var schedule = "<thead><tr><th>Home</th><th>Away</th><th>Projected Winner</th></tr></thead>";
    $.ajax({url:`/getSchedule?week=${week}`, success: (result)=>{
      var games = JSON.parse(result);
      games.forEach((game)=>{
        schedule += 
        `<tr><td>${game.Home}</td><td>${game.Away}</td><td><button class="btn btn-dark" id="${game.Home}" onclick='findWinner("${game.Home}", "${game.Away}")'>Find Out!</button></td></tr>`;
      })

      table.innerHTML = schedule;

  }})
  }
</script>

<body>
  <% include ../partials/nav.ejs %>
  <div class="container">
  <div class="jumbotron">
  <h4 style="text-align: center;">Predict Winners</h4>
  <p style="text-align: center;">Pick a week to load and then find out which team will win each game! </p>
</div>
</div>
  <div style="margin-top: 5%" id="weekSelectDiv">
  <select id="weekSelect">
  <option value = "1">Week 1</option>
  <option value = "2">Week 2</option>
  <option value = "3">Week 3</option>
  <option value = "4">Week 4</option>
  <option value = "5">Week 5</option>
  <option value = "6">Week 6</option>
  <option value = "7">Week 7</option>
  <option value = "8">Week 8</option>
  <option value = "9">Week 9</option>
  <option value = "10">Week 10</option>
  <option value = "11">Week 11</option>
  <option value = "12">Week 12</option>
  <option value = "13">Week 13</option>
  <option value = "14">Week 14</option>
  <option value = "15">Week 15</option>
  <option value = "16">Week 16</option>
  <option value = "17">Week 17</option>
</select>
  <button onclick="loadWeek()">Load Week</button></div>
  <table id="schedule" class="table table-bordered">
    <thead ><tr><th>Home</th><th>Away</th><th>Projected Winner</th></tr>
  
    </thead>
  </table>


</body>
</html>
